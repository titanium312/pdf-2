<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Biblioteca de PDFs (Auto)</title>
  <style>
    :root { --bg:#0b1020; --card:#141a2e; --muted:#5b6b8c; --txt:#e8ecf7; --accent:#7aa2ff; }
    *{box-sizing:border-box}
    body{margin:0; font-family:ui-sans-serif,system-ui,Segoe UI,Roboto; background:var(--bg); color:var(--txt)}
    header{display:flex; gap:12px; align-items:center; justify-content:space-between; padding:24px 20px; position:sticky; top:0; background:linear-gradient(180deg, rgba(11,16,32,.95), rgba(11,16,32,.7), transparent); backdrop-filter: blur(6px); border-bottom:1px solid rgba(255,255,255,.06)}
    h1{margin:0; font-size:20px; letter-spacing:.4px}
    .search{display:flex; align-items:center; gap:10px; background:var(--card); border:1px solid rgba(255,255,255,.08); padding:10px 12px; border-radius:12px; width: min(520px, 92vw)}
    .search input{all:unset; width:100%; color:var(--txt)}
    .container{max-width:1100px; margin:20px auto; padding:0 16px}
    .grid{display:grid; grid-template-columns: repeat(auto-fill, minmax(260px,1fr)); gap:16px}
    .card{background:var(--card); border:1px solid rgba(255,255,255,.08); border-radius:16px; padding:14px; box-shadow:0 8px 20px rgba(0,0,0,.25); transition:transform .15s ease, box-shadow .15s ease, border-color .15s; display:flex; flex-direction:column; gap:12px}
    .card:hover{transform: translateY(-2px); border-color: rgba(122,162,255,.4); box-shadow:0 10px 24px rgba(0,0,0,.35)}
    .title{font-weight:600; font-size:16px; line-height:1.35}
    .meta{font-size:12px; color:var(--muted)}
    .btns{display:flex; gap:8px}
    .btn{flex:1; text-align:center; text-decoration:none; padding:10px 12px; border-radius:10px; border:1px solid rgba(255,255,255,.08); background:#0f1629; color:var(--txt); font-weight:600}
    .btn.primary{background:linear-gradient(180deg, #1f2a4a, #162243); border-color:#2d3b63; color:#dfe8ff}
    .empty{color:var(--muted); text-align:center; padding:40px}
    footer{padding:26px; text-align:center; color:var(--muted)}
  </style>
</head>
<body>
  <header>
    <h1>ðŸ“š Biblioteca de PDFs (Auto)</h1>
    <label class="search">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M21 21l-4.3-4.3m1.3-5.2a6.5 6.5 0 11-13 0 6.5 6.5 0 0113 0z" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/></svg>
      <input id="q" placeholder="Buscar por nombreâ€¦" />
    </label>
  </header>

  <div class="container">
    <div id="grid" class="grid"></div>
    <div id="empty" class="empty" style="display:none">Sin resultados</div>
  </div>

  <footer>Sube PDFs a <code>/public/pdfs</code>. Se listan automÃ¡ticamente con <code>/api/list-pdfs</code>.</footer>

  <script>
    const grid = document.getElementById('grid');
    const empty = document.getElementById('empty');
    const q = document.getElementById('q');

    let items = [];
    async function load() {
      try {
        const res = await fetch('/api/list-pdfs?_=' + Date.now());
        items = await res.json();
        render(items);
        q.addEventListener('input', () => {
          const term = q.value.trim().toLowerCase();
          const filtered = items.filter(i => (i.name||'').toLowerCase().includes(term) || (i.file||'').toLowerCase().includes(term));
          render(filtered);
        });
      } catch (e) {
        grid.innerHTML = '<div class="empty">No se pudo cargar la lista</div>';
      }
    }

    function render(list){
      grid.innerHTML = list.map(it => card(it)).join('');
      empty.style.display = list.length ? 'none' : 'block';
    }
    function esc(s){ return String(s).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])) }
    function card(it){
      const name = esc(it.name || it.file);
      const file = esc(it.file);
      return `
        <article class="card">
          <div class="title">${name}</div>
          <div class="meta">${file}</div>
          <div class="btns">
            <a class="btn primary" href="/viewer.html?file=${encodeURIComponent(file)}">Ver</a>
            <a class="btn" href="/pdfs/${encodeURIComponent(file)}" target="_blank" rel="noopener">Abrir pestaÃ±a</a>
          </div>
        </article>
      `;
    }
    load();
  </script>
</body>
</html>
