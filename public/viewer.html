<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Visor PDF - Hospital San Jorge de Ayapel</title>
  <style>
    :root { 
      --primary: #13b8c5;
      --primary-light: rgb(155, 236, 238);
      --bg: #f9fafb;
      --panel: #ffffff;
      --txt: #0f172a;
      --muted: #64748b;
      --border: #e2e8f0;
      --shadow: rgba(0,0,0,0.08);
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      background: var(--bg);
      color: var(--txt);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      line-height: 1.6;
    }

    .header {
      background: linear-gradient(135deg, var(--primary), var(--primary-light));
      color: white;
      box-shadow: 0 4px 12px var(--shadow);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .header-content {
      max-width: 1200px;
      margin: 0 auto;
      padding: 14px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 12px;
    }

    .hospital-info h1 {
      margin: 0;
      font-size: 20px;
      font-weight: 700;
    }

    .hospital-info .subtitle {
      margin: 0;
      font-size: 13px;
      opacity: 0.9;
      font-weight: 400;
    }

    .header-actions {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .btn {
      border: none;
      background: rgba(255,255,255,0.2);
      color: white;
      padding: 8px 14px;
      border-radius: 6px;
      font-weight: 500;
      cursor: pointer;
      text-decoration: none;
      font-size: 14px;
      transition: all 0.2s ease;
    }

    .btn:hover {
      background: rgba(255,255,255,0.3);
      transform: translateY(-1px);
    }

    .btn.primary {
      background: white;
      color: var(--primary);
      font-weight: 600;
    }
    .btn.primary:hover {
      background: var(--primary-light);
    }

    main {
      max-width: 1200px;
      margin: 0 auto;
      padding: 24px 20px;
    }

    .document-info {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 18px;
      margin-bottom: 20px;
      box-shadow: 0 2px 6px var(--shadow);
    }

    .document-title {
      margin: 0 0 8px 0;
      font-size: 20px;
      font-weight: 600;
      color: var(--primary);
    }

    .document-meta {
      display: flex;
      gap: 18px;
      color: var(--muted);
      font-size: 14px;
      flex-wrap: wrap;
    }

    .pdf-container {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 2px 10px var(--shadow);
      position: relative;
    }

    .pdf-container::before {
      content: '';
      position: absolute;
      top: 0; left: 0; right: 0;
      height: 3px;
      background: linear-gradient(90deg, var(--primary), var(--primary-light));
    }

    iframe {
      width: 100%;
      height: 80vh;
      min-height: 600px;
      display: block;
      background: #f4f4f4;
      border: none;
    }

    .help-text {
      background: var(--primary-light);
      border-radius: 8px;
      padding: 14px;
      margin-top: 16px;
      font-size: 14px;
      color: #064e53;
    }

    .footer {
      margin-top: 40px;
      padding-top: 18px;
      border-top: 1px solid var(--border);
      text-align: center;
      color: var(--muted);
      font-size: 12px;
    }
  </style>
</head>
<body>
  <header class="header">
    <div class="header-content">
      <div class="hospital-info">
        <h1>Hospital San Jorge de Ayapel</h1>
        <p class="subtitle">Sistema de Documentos Digitales</p>
      </div>
      <div class="header-actions">
        <a class="btn" href="https://hospitalsanjorgeayapel.com/">Volver al Portal</a>
      </div>
    </div>
  </header>

  <main>
    <div class="document-info">
      <h2 class="document-title">
        <span id="documentName">Documento</span>
      </h2>
    </div>

    <div class="pdf-container">
      <iframe id="pdfFrame" src=""></iframe>
    </div>

    <div class="help-text">
      Si el documento no se visualiza correctamente, use "Abrir en nueva pesta?a" o "Descargar".
    </div>

    <div class="footer">
      ? 2025 Hospital San Jorge de Ayapel - Todos los derechos reservados<br>
      Sistema de gesti¨®n documental institucional
    </div>
  </main>

  <script>
    const params = new URLSearchParams(location.search);
    const file = (params.get('file') || '').replace(/[^\w\-\. %]/g, '');
    const src = file ? '/pdfs/' + encodeURIComponent(file) : '';

    const pdfFrame = document.getElementById('pdfFrame');
    const openTab = document.getElementById('openTab');
    const download = document.getElementById('download');
    const documentName = document.getElementById('documentName');
    const currentDate = document.getElementById('currentDate');

    function formatCurrentDate() {
      const now = new Date();
      const options = {
        weekday: 'long', year: 'numeric', month: 'long',
        day: 'numeric', hour: '2-digit', minute: '2-digit'
      };
      return now.toLocaleDateString('es-CO', options);
    }

    function getCleanFileName(filename) {
      return filename.replace(/\.(pdf|PDF)$/, '').replace(/[-_]/g, ' ');
    }

    function init() {
      if (currentDate) currentDate.textContent = formatCurrentDate();

      if (!file) {
        pdfFrame.srcdoc = `
          <div style="padding:40px;text-align:center;font-family:system-ui;">
            <h3 style="color:#e53e3e;">No se especific¨® ning¨²n documento</h3>
            <p>Agregue el par¨¢metro <code>?file=archivo.pdf</code> a la URL.</p>
          </div>`;
        if (documentName) documentName.textContent = 'Sin documento especificado';
        if (openTab) { openTab.style.opacity = '.5'; openTab.style.pointerEvents = 'none'; }
        if (download) { download.style.opacity = '.5'; download.style.pointerEvents = 'none'; }
      } else {
        pdfFrame.src = src;
        if (openTab) openTab.href = src;
        if (download) { download.href = src; download.download = file; }
        const cleanName = getCleanFileName(file);
        if (documentName) documentName.textContent = cleanName;
        document.title = `${cleanName} - Hospital San Jorge de Ayapel`;
      }
    }

    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
